<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Titan Rover Cerium</title>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="cer.css">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script type="text/javascript">
      var camera = 'http://192.168.1.242:8081';
      var ros = new ROSLIB.Ros({ // Make a new ros object
        url : 'ws://192.168.1.242:9090'
      });
      var throttle_default = 0;
      var throttle_max = 100;
      var throttle_min = -100;
      var turn_default = 0;
      var turn_max = 127;
      var turn_min = -127;
      var rosbridge_obj = new ROSLIB.Topic({ // Create a topic object
        ros : ros,
        name : '/joy/0',
        messageType : 'sensor_msgs/Joy'
      });
      var message_obj = new ROSLIB.Message({ // Create the message payload to be published
        header : {
          seq : 0,
          stamp : 0,
          frame_id : 'Titan Rover',
        },
      	axes : [
      	   0, 0, 0
      	],
      	buttons : [
      	0, 0, 0
      	]
      });
      function reporter() { // Console log and publish current values
          var message_obj = new ROSLIB.Message({ // Create the message payload to be published
            header : {
              seq : 0,
              stamp : 0,
              frame_id : 'Titan Rover',
            },
            axes : [
               parseFloat(document.getElementById("throttle").value),
               parseFloat(document.getElementById("turn").value),
               0
            ],
            buttons : [
            0, 0, 0
            ]
          });
          console.log("Throttle: ", document.getElementById("throttle").value);
          console.log("Regular Message: ", message_obj);
          rosbridge_obj.publish(message_obj); // Publish the message
      }
      $(document).ready(function(){ // After app has loaded
        //$('iframe#roverview1').attr('src', camera); // Load the camera stream
        $('iframe#roverview2').attr('src', camera); // Load the camera stream
        setInterval(reporter, 75); // Call reporter every 100ms
        document.getElementById("throttle").min = throttle_min;
        document.getElementById("throttle").max = throttle_max;
        document.getElementById("throttle").value = throttle_default;
        document.getElementById("turn").min = turn_min;
        document.getElementById("turn").max = turn_max;
        document.getElementById("turn").value = turn_default;
      });
      ros.on('error', function(error) { // Emit an 'error' if there is an error on the backend
        console.log(error);
        document.getElementById("status_roshost").innerHTML = "Cannot connect: " + error;
        document.getElementById("status_roshost").style = "color:RED";
      });
      ros.on('connection', function() { // Report a successful connection attempt
        console.log("Connected to Rover");
        document.getElementById("status_roshost").innerHTML = "Connected to Rover";
        document.getElementById("status_roshost").style = "color:GREEN";
      });
      ros.on('close', function(reason) { // Report a connection closed
        console.log("Rover has closed the connection");
        console.log(reason);
        document.getElementById("status_roshost").innerHTML = "Rover has closed the connection";
        document.getElementById("status_roshost").style = "color:ORANGE";
      });
    </script>
  </head>
  <body>
    <div>
        <h4>Titan Rover Cerium</h4>
        <h4>1.16.19.1</h4>
    </div>
    <div><p id="status_roshost">Status Unavailable</p></div>
    <!-- <div><iframe id="roverview1" src=""></iframe></div> -->
    <div class="video-background">
      <div class="video-foreground">
        <iframe id="roverview2" src="" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
    <div><input type="range" id="throttle"></div>
    <div><label>Throttle</label></div>
    <div><input type="range" id="turn"></div>
    <div><label>Turn</label></div>
  </body>
</html>
